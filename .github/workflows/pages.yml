name: GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true
          fetch-depth: 0

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'
          extended: true

      - name: Build
        env:
          # GitHub PagesのbaseURLを動的に設定
          REPO_NAME: ${{ github.event.repository.name }}
          REPO_OWNER: ${{ github.repository_owner }}
        run: |
          # リポジトリ名がusername.github.ioの場合は特別な処理
          if [ "$REPO_NAME" = "${REPO_OWNER}.github.io" ]; then
            BASE_URL="https://${REPO_OWNER}.github.io/"
          else
            BASE_URL="https://${REPO_OWNER}.github.io/${REPO_NAME}/"
          fi
          # baseURLを設定してビルド
          hugo --minify --baseURL "$BASE_URL"

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'